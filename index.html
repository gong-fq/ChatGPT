<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History of English Learning App</title>
    <link rel="icon" href="data:,">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; color: #333; }
        .container { border: 1px solid #ddd; border-radius: 8px; padding: 20px; background-color: #fff; }
        h2 { border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        textarea { width: 100%; height: 150px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; resize: vertical; }
        .button-group { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; background-color: #f0f0f0; border: 1px solid #ccc; transition: all 0.2s; }
        button:hover { background-color: #e0e0e0; }
        .btn-primary { background-color: #007bff; color: white; border: none; }
        .btn-primary:hover { background-color: #0056b3; }
        #response-box { padding: 15px; background-color: #f8f9fa; border-left: 4px solid #007bff; min-height: 50px; white-space: pre-wrap; margin-top: 10px; }
        .footer { text-align: center; margin-top: 40px; font-size: 0.9em; color: #666; }
    </style>
</head>
<body>

    <div class="header">
        <p>This interactive app introduces the historical development of English. æœ¬åº”ç”¨ç³»ç»Ÿè®²è§£è‹±è¯­ä»å²å‰é˜¶æ®µåˆ°å…¨çƒè‹±è¯­çš„å‘å±•å†ç¨‹ã€‚</p>
        <p><strong>ç”±é¾šå‡¤ä¹¾æ•™æˆç²¾å¿ƒè®¾è®¡</strong></p>
    </div>

    <div class="container">
        <h2>Interactive Learning Zone / äº’åŠ¨å­¦ä¹ åŒº</h2>
        
        <textarea id="user-input" placeholder="Ask any academic question about the history of English..."></textarea>

        <div class="button-group">
            <button class="btn-primary" onclick="askAI()">ğŸ“˜ Ask DeepSeek</button>
            <button onclick="alert('Voice input feature coming soon!')">ğŸ¤ Voice Input</button>
            <button onclick="readText()">ğŸ”Š Read Selected Text</button>
        </div>

        <div id="response-box">No response.</div>
    </div>

    <div class="footer">
        Â© History of English Learning App Â· Netlify + DeepSeek
    </div>

    <script>
        // å®šä¹‰ AI è¯¢é—®å‡½æ•°
        async function askAI() {
            const userInput = document.getElementById('user-input').value;
            const responseBox = document.getElementById('response-box');

            if (!userInput.trim()) {
                alert("Please enter a question! / è¯·è¾“å…¥é—®é¢˜ï¼");
                return;
            }

            // æ›´æ–° UI çŠ¶æ€
            responseBox.innerText = "Waiting for response... / æ­£åœ¨æ€è€ƒä¸­...";

            try {
                // å‘èµ· POST è¯·æ±‚åˆ° Netlify Function
                const response = await fetch("/.netlify/functions/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    // è¿™é‡Œå‘é€çš„æ•°æ®ç»“æ„å¿…é¡»ä¸ chat.js é‡Œçš„ JSON.parse å¯¹åº”
                    body: JSON.stringify({ question: userInput })
                });

                // æ£€æŸ¥ HTTP çŠ¶æ€ç 
                if (!response.ok) {
                    const errorMsg = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorMsg}`);
                }

                const data = await response.json();

                // æ˜¾ç¤ºç»“æœ
                if (data.answer) {
                    responseBox.innerText = data.answer;
                } else {
                    responseBox.innerText = "Error: Invalid response format from server.";
                }

            } catch (error) {
                console.error("Fetch Error:", error);
                responseBox.innerText = "Error contacting server: " + error.message;
            }
        }

        // æœ—è¯»åŠŸèƒ½çš„ç®€å•å®ç°
       // ä¿®å¤åçš„è¯­éŸ³æœ—è¯»åŠŸèƒ½ï¼šæ”¯æŒä¸­è‹±åŒè¯­è‡ªåŠ¨åˆ‡æ¢
function readText() {
    // è·å–é€‰ä¸­çš„æ–‡å­—ï¼Œå¦‚æœæ²¡æœ‰é€‰ä¸­ï¼Œåˆ™è·å–å›å¤æ¡†ä¸­çš„å…¨éƒ¨æ–‡å­—
    const selection = window.getSelection().toString();
    const textToRead = selection || document.getElementById('response-box').innerText;
    
    if (textToRead && textToRead !== "No response." && textToRead !== "Waiting for response... / æ­£åœ¨æ€è€ƒä¸­...") {
        const utterance = new SpeechSynthesisUtterance(textToRead);

        // æ ¸å¿ƒé€»è¾‘ï¼šæ£€æµ‹æ–‡æœ¬ä¸­æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦
        const hasChinese = /[\u4e00-\u9fa5]/.test(textToRead);
        
        if (hasChinese) {
            utterance.lang = 'zh-CN'; // å¦‚æœæœ‰ä¸­æ–‡ï¼Œä½¿ç”¨ä¸­æ–‡å‘éŸ³
            utterance.rate = 1.0;     // è¯­é€Ÿè®¾ç½®
        } else {
            utterance.lang = 'en-US'; // çº¯è‹±æ–‡åˆ™ç»§ç»­ä½¿ç”¨è‹±æ–‡å‘éŸ³
            utterance.rate = 0.9;     // è‹±æ–‡è¯­é€Ÿç¨å¾®æ”¾æ…¢ä¸€ç‚¹ç‚¹ï¼Œæ–¹ä¾¿å­¦ä¹ 
        }

        // åœæ­¢å½“å‰æ­£åœ¨è¿›è¡Œçš„æœ—è¯»ï¼ˆé˜²æ­¢é‡å ï¼‰ï¼Œå¼€å§‹æ–°æœ—è¯»
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
    } else {
        alert("Nothing to read! Please wait for a response or select some text.");
    }
}
    </script>
</body>
</html>